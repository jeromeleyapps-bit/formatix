@{
    ViewData["Title"] = "Agenda";
}

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Agenda des sessions</h5>
        <a asp-controller="Sessions" asp-action="Create" class="btn btn-sm btn-primary">Nouvelle session</a>
    </div>
    <div class="card-body">
        <div id="agenda-calendar"></div>
    </div>
</div>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@@6.1.10/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@@6.1.10/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@@fullcalendar/core@@6.1.10/locales/fr.global.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('agenda-calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'fr',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,listWeek'
        },
        buttonText: {
            today: 'Aujourd\'hui',
            month: 'Mois',
            week: 'Semaine',
            list: 'Liste'
        },
        events: function(info, successCallback, failureCallback) {
            var params = new URLSearchParams();
            if (info.start) params.set('start', info.startStr);
            if (info.end) params.set('end', info.endStr);
            fetch('/Agenda/Events?' + params.toString(), {
                headers: { 'Accept': 'application/json' },
                credentials: 'same-origin'
            })
            .then(function(r) { return r.json(); })
            .then(function(events) { successCallback(events); })
            .catch(function(e) { failureCallback(e); });
        },
        eventClick: function(arg) {
            if (arg.event.url) {
                arg.jsEvent.preventDefault();
                window.location.href = arg.event.url;
            }
        }
    });
    calendar.render();
});
</script>
